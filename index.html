<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Symposium Election 2025</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0a0a20;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(138, 43, 226, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 30%, rgba(30, 144, 255, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 50% 80%, rgba(255, 107, 107, 0.1) 0%, transparent 30%);
        }

        /* Particle Background for Winner Announcement */
        .particles-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .particles-background.active {
            opacity: 1;
        }

        .particle {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.3; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(10, 10, 40, 0.7);
            border-radius: 20px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #8a2be2, #1e90ff, #ff6b6b);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 5s ease infinite;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            letter-spacing: 1px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tab-btn {
            font-family: 'Orbitron', sans-serif;
            background: rgba(30, 144, 255, 0.1);
            border: 1px solid rgba(30, 144, 255, 0.3);
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        .tab-btn:hover {
            background: rgba(30, 144, 255, 0.2);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #8a2be2, #1e90ff);
            border-color: #8a2be2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: rgba(10, 10, 40, 0.7);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Winner Announcement */
        .winner-announcement {
            text-align: center;
            padding: 50px 40px;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(30, 144, 255, 0.2));
            border-radius: 25px;
            border: 2px solid rgba(138, 43, 226, 0.5);
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            animation: winnerReveal 2s ease-out;
        }

        @keyframes winnerReveal {
            0% {
                opacity: 0;
                transform: scale(0.8) rotateY(90deg);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05) rotateY(45deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotateY(0deg);
            }
        }

        /* Animated Background Pattern */
        .winner-announcement::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%),
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 10px,
                    rgba(138, 43, 226, 0.1) 10px,
                    rgba(138, 43, 226, 0.1) 20px
                );
            animation: shine 8s linear infinite;
            z-index: -1;
        }

        @keyframes shine {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Floating Crown Animation */
        .winner-announcement::after {
            content: 'üëë';
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 3rem;
            animation: crownFloat 4s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
        }

        @keyframes crownFloat {
            0%, 100% { 
                transform: translateY(0) rotate(-5deg) scale(1); 
                filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
            }
            25% { 
                transform: translateY(-15px) rotate(5deg) scale(1.1); 
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1));
            }
            50% { 
                transform: translateY(-8px) rotate(-2deg) scale(1.05); 
                filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.9));
            }
            75% { 
                transform: translateY(-20px) rotate(3deg) scale(1.08); 
                filter: drop-shadow(0 0 25px rgba(255, 215, 0, 1));
            }
        }

        .winner-announcement h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 40px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #8a2be2, #1e90ff);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbowText 3s ease-in-out infinite;
            letter-spacing: 3px;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        @keyframes rainbowText {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 100% 0%; }
        }

        /* Enhanced Winners Grid */
        .winners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .winner-card {
            background: rgba(30, 144, 255, 0.1);
            padding: 35px 25px;
            border-radius: 20px;
            border: 2px solid rgba(138, 43, 226, 0.5);
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            animation: cardSlideIn 1s ease-out;
            animation-fill-mode: both;
        }

        .winner-card:nth-child(1) { animation-delay: 0.2s; }
        .winner-card:nth-child(2) { animation-delay: 0.4s; }
        .winner-card:nth-child(3) { animation-delay: 0.6s; }

        @keyframes cardSlideIn {
            0% {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .winner-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(138, 43, 226, 0.4);
            border-color: #ffd700;
        }

        /* Victory Type Indicators */
        .winner-card.landslide {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .winner-card.close-race {
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
        }

        /* Animated Background Gradient */
        .winner-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(30, 144, 255, 0.1));
            z-index: -1;
            transition: all 0.3s ease;
        }

        .winner-card:hover::after {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(30, 144, 255, 0.2));
        }

        /* Crown Badge */
        .winner-card::before {
            content: 'üëë';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 2rem;
            animation: crownBounce 2s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
        }

        @keyframes crownBounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(10deg); }
        }

        .winner-position {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e90ff;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .winner-name {
            font-size: 1.8rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            animation: nameGlow 3s ease-in-out infinite;
        }

        @keyframes nameGlow {
            0%, 100% { text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); }
            50% { text-shadow: 0 0 20px rgba(138, 43, 226, 0.8), 0 2px 4px rgba(0, 0, 0, 0.5); }
        }

        /* Victory Margin Display */
        .victory-margin {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .victory-margin.landslide {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 140, 0, 0.2));
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.5);
        }

        .victory-margin.comfortable {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2));
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .victory-margin.close {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 152, 0, 0.2));
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.5);
        }

        .victory-margin.unanimous {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(30, 144, 255, 0.2));
            color: #8a2be2;
            border: 1px solid rgba(138, 43, 226, 0.5);
        }

        .win-percentage {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 8px;
        }

        /* Enhanced Countdown */
        .countdown-display {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .time-unit {
            background: rgba(255,255,255,0.15);
            padding: 20px 15px;
            border-radius: 15px;
            min-width: 85px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .time-unit::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: sweep 4s linear infinite;
        }

        @keyframes sweep {
            0% { transform: translateX(-100%) translateY(-100%); }
            100% { transform: translateX(100%) translateY(100%); }
        }

        .time-unit.critical {
            animation: critical 1s ease-in-out infinite;
        }

        @keyframes critical {
            0%, 100% { 
                background: rgba(255,107,107,0.2);
                border-color: rgba(255,107,107,0.5);
                transform: scale(1);
            }
            50% { 
                background: rgba(255,107,107,0.4);
                border-color: rgba(255,107,107,0.8);
                transform: scale(1.05);
            }
        }

        .time-value {
            display: block;
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            line-height: 1;
            position: relative;
            z-index: 1;
        }

        .time-label {
            display: block;
            font-size: 0.85rem;
            opacity: 0.9;
            text-transform: uppercase;
            margin-top: 8px;
            position: relative;
            z-index: 1;
        }

        /* Pre-fetch Loading Animation */
        .pre-fetch-loading {
            text-align: center;
            padding: 40px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }

        .cosmic-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid rgba(138, 43, 226, 0.2);
            border-top: 4px solid #8a2be2;
            border-right: 4px solid #1e90ff;
            border-radius: 50%;
            animation: cosmicSpin 2s linear infinite;
        }

        @keyframes cosmicSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Celebration Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            top: -10px;
            animation: confetti-fall 3s linear infinite;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti:nth-child(1) { left: 10%; background: #ff6b6b; animation-delay: 0s; }
        .confetti:nth-child(2) { left: 20%; background: #4ecdc4; animation-delay: 0.3s; }
        .confetti:nth-child(3) { left: 30%; background: #45b7d1; animation-delay: 0.6s; }
        .confetti:nth-child(4) { left: 40%; background: #f9ca24; animation-delay: 0.9s; }
        .confetti:nth-child(5) { left: 50%; background: #6c5ce7; animation-delay: 1.2s; }
        .confetti:nth-child(6) { left: 60%; background: #a29bfe; animation-delay: 1.5s; }
        .confetti:nth-child(7) { left: 70%; background: #fd79a8; animation-delay: 1.8s; }
        .confetti:nth-child(8) { left: 80%; background: #00b894; animation-delay: 2.1s; }
        .confetti:nth-child(9) { left: 90%; background: #ffeaa7; animation-delay: 2.4s; }

        /* Rest of the existing styles remain the same... */
        /* [Previous styles for nominees, voting form, etc. would continue here] */

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(30, 144, 255, 0.2);
            border-left: 4px solid #8a2be2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .winner-announcement h2 {
                font-size: 2.2rem;
            }

            .winners-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .countdown-timer {
                gap: 15px;
            }
            
            .time-unit {
                min-width: 70px;
                padding: 15px 10px;
            }
            
            .time-value {
                font-size: 1.8rem;
            }
        }

        /* Additional styles for other sections would continue here... */
    </style>
</head>
<body>
    <!-- Particle Background -->
    <div class="particles-background" id="particles-background">
        <!-- Particles will be generated by JavaScript -->
    </div>

    <div class="container">
        <div class="header">
            <h1>üåå Galactic Symposium Election 2025 üåå</h1>
            <p>Where Cosmic Democracy Meets Stellar Leadership</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn" onclick="showTab('nominees')">Meet Nominees</button>
            <button class="tab-btn" onclick="showTab('vote')">Cast Vote</button>
            <button class="tab-btn active" onclick="showTab('results')">Live Results</button>
        </div>

        <!-- Nominees Tab -->
        <div id="nominees-tab" class="tab-content">
            <div style="text-align: center; padding: 40px;">
                <h2 style="font-family: 'Orbitron', sans-serif; color: #8a2be2; margin-bottom: 20px;">üåü Meet Your Galactic Nominees</h2>
                <p>The stellar candidates are preparing for the cosmic reveal...</p>
            </div>
        </div>

        <!-- Voting Tab -->
        <div id="vote-tab" class="tab-content">
            <div style="text-align: center; padding: 40px;">
                <h2 style="font-family: 'Orbitron', sans-serif; color: #8a2be2; margin-bottom: 20px;">Cast Your Cosmic Vote</h2>
                <p>Voting interface coming soon...</p>
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results-tab" class="tab-content active">
            <h2 style="font-family: 'Orbitron', sans-serif; text-align: center; margin-bottom: 30px; font-size: 2rem; color: #8a2be2;">Live Galactic Results</h2>
            
            <!-- Winner Announcement Display -->
            <div id="winner-announcement" style="display: none;">
                <!-- Winner announcement will be shown here -->
            </div>

            <!-- Pre-fetch Loading Display -->
            <div id="pre-fetch-display" style="display: none;">
                <div class="pre-fetch-loading">
                    <div class="cosmic-spinner"></div>
                    <h3 style="color: #8a2be2; margin-bottom: 15px;">üîÆ Preparing Galactic Results...</h3>
                    <p style="opacity: 0.8;">The cosmic ballot box is being unsealed...</p>
                </div>
            </div>

            <!-- Countdown Display -->
            <div id="announcement-countdown" style="display: none;">
                <div class="election-status-banner announcement">
                    <div class="status-content">
                        <div style="font-size: 1.3rem; font-weight: 700; margin-bottom: 20px;">
                            üéâ COSMIC REVELATION IMMINENT! üéâ
                        </div>
                        <div class="countdown-display">
                            <div class="countdown-timer">
                                <div class="time-unit" id="announce-days-unit">
                                    <span id="announce-days" class="time-value">00</span>
                                    <span class="time-label">Days</span>
                                </div>
                                <div class="time-unit" id="announce-hours-unit">
                                    <span id="announce-hours" class="time-value">00</span>
                                    <span class="time-label">Hours</span>
                                </div>
                                <div class="time-unit" id="announce-minutes-unit">
                                    <span id="announce-minutes" class="time-value">00</span>
                                    <span class="time-label">Minutes</span>
                                </div>
                                <div class="time-unit" id="announce-seconds-unit">
                                    <span id="announce-seconds" class="time-value">00</span>
                                    <span class="time-label">Seconds</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Container -->
            <div id="results-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Scanning the cosmos for results...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let announcementStatus = {};
        let announcementCountdownInterval = null;
        let preFetchedWinners = null;

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'results') {
                loadWinnerAnnouncement();
            }
        }

        // Generate particles for background effect
        function generateParticles() {
            const particlesContainer = document.getElementById('particles-background');
            particlesContainer.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = (Math.random() * 4 + 2) + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.background = [
                    '#8a2be2', '#1e90ff', '#ff6b6b', '#ffd700', '#4ecdc4'
                ][Math.floor(Math.random() * 5)];
                
                particlesContainer.appendChild(particle);
            }
        }

        // Create confetti effect
        function createConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.style.position = 'fixed';
            confettiContainer.style.top = '0';
            confettiContainer.style.left = '0';
            confettiContainer.style.width = '100%';
            confettiContainer.style.height = '100%';
            confettiContainer.style.pointerEvents = 'none';
            confettiContainer.style.zIndex = '1000';
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = [
                    '#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#6c5ce7',
                    '#a29bfe', '#fd79a8', '#00b894', '#ffeaa7', '#ffd700'
                ][Math.floor(Math.random() * 10)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                confettiContainer.appendChild(confetti);
            }
            
            document.body.appendChild(confettiContainer);
            
            // Remove confetti after animation
            setTimeout(() => {
                document.body.removeChild(confettiContainer);
            }, 5000);
        }

        // Load winner announcement status
        async function loadWinnerAnnouncement() {
            try {
                const response = await axios.get('/.netlify/functions/get-winner-announcement');
                announcementStatus = response.data;
                
                // Store pre-fetched winners if available
                if (announcementStatus.preFetchedWinners) {
                    preFetchedWinners = announcementStatus.preFetchedWinners;
                }
                
                updateAnnouncementDisplay();
                
                // Clear any existing countdown interval
                if (announcementCountdownInterval) {
                    clearInterval(announcementCountdownInterval);
                }
                
                // Start countdown if needed
                if (announcementStatus.status === 'SCHEDULED' || announcementStatus.status === 'PRE_FETCH') {
                    startAnnouncementCountdown();
                } else if (announcementStatus.isAnnounced && announcementStatus.winners) {
                    displayWinners(announcementStatus.winners);
                }
                
            } catch (error) {
                console.error('Error loading winner announcement:', error);
                document.getElementById('results-container').innerHTML = 
                    '<div style="text-align: center; padding: 40px; color: #ff6b6b;">Unable to load results at this time</div>';
            }
        }

        // Update announcement display based on status
        function updateAnnouncementDisplay() {
            const announcementDiv = document.getElementById('winner-announcement');
            const countdownDiv = document.getElementById('announcement-countdown');
            const preFetchDiv = document.getElementById('pre-fetch-display');
            const resultsContainer = document.getElementById('results-container');
            
            // Hide all elements first
            announcementDiv.style.display = 'none';
            countdownDiv.style.display = 'none';
            preFetchDiv.style.display = 'none';
            resultsContainer.style.display = 'none';
            
            if (announcementStatus.status === 'ANNOUNCED' && announcementStatus.winners) {
                // Show winners immediately
                announcementDiv.style.display = 'block';
                displayWinners(announcementStatus.winners);
            } else if (announcementStatus.status === 'PRE_FETCH') {
                // Show pre-fetch loading with countdown
                preFetchDiv.style.display = 'block';
                countdownDiv.style.display = 'block';
            } else if (announcementStatus.status === 'SCHEDULED') {
                // Show countdown only
                countdownDiv.style.display = 'block';
            } else {
                // Show regular results or loading
                resultsContainer.style.display = 'block';
            }
        }

        // Start countdown to announcement with enhanced animations
        function startAnnouncementCountdown() {
            let remainingTime = announcementStatus.timeUntilAnnouncement;
            
            const updateCountdown = () => {
                if (remainingTime <= 0) {
                    clearInterval(announcementCountdownInterval);
                    
                    // If we have pre-fetched winners, show them immediately
                    if (preFetchedWinners) {
                        displayWinners(preFetchedWinners);
                    } else {
                        // Otherwise, reload announcement status
                        loadWinnerAnnouncement();
                    }
                    return;
                }
                
                const totalSeconds = Math.floor(remainingTime / 1000);
                const days = Math.floor(totalSeconds / 86400);
                const hours = Math.floor((totalSeconds % 86400) / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                
                // Update countdown display
                const daysEl = document.getElementById('announce-days');
                const hoursEl = document.getElementById('announce-hours');
                const minutesEl = document.getElementById('announce-minutes');
                const secondsEl = document.getElementById('announce-seconds');
                
                if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
                if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
                if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
                if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
                
                // Add critical animation when less than 1 minute
                const timeUnits = document.querySelectorAll('.time-unit');
                if (totalSeconds <= 60) {
                    timeUnits.forEach(unit => unit.classList.add('critical'));
                } else {
                    timeUnits.forEach(unit => unit.classList.remove('critical'));
                }
                
                // Add special effects when very close (10 seconds)
                if (totalSeconds <= 10 && totalSeconds > 0) {
                    document.body.style.animation = 'pulse 0.5s ease-in-out infinite';
                }
                
                remainingTime -= 1000;
            };
            
            updateCountdown();
            announcementCountdownInterval = setInterval(updateCountdown, 1000);
        }

        // Display winners with enhanced animations and victory margins
        function displayWinners(winnerData) {
            const announcementDiv = document.getElementById('winner-announcement');
            const countdownDiv = document.getElementById('announcement-countdown');
            const preFetchDiv = document.getElementById('pre-fetch-display');
            
            // Hide countdown and pre-fetch displays
            countdownDiv.style.display = 'none';
            preFetchDiv.style.display = 'none';
            
            // Activate particle background
            const particlesBackground = document.getElementById('particles-background');
            particlesBackground.classList.add('active');
            generateParticles();
            
            // Create confetti effect
            createConfetti();
            
            const winners = winnerData.winners;
            
            let winnersHtml = `
                <div class="winner-announcement">
                    <h2>üèÜ GALACTIC CHAMPIONS REVEALED! üèÜ</h2>
                    <div class="winners-grid">
            `;

            Object.entries(winners).forEach(([position, winner]) => {
                const positionTitles = {
                    president: 'Galactic President',
                    secretary: 'Cosmic Secretary',
                    treasurer: 'Nebula Treasurer'
                };

                // Determine victory type for styling
                let victoryClass = '';
                let victoryText = '';
                let marginClass = '';
                
                if (winner.runnerUpName === 'No opponent') {
                    victoryClass = 'unanimous';
                    victoryText = 'üåü Unanimous Victory!';
                    marginClass = 'unanimous';
                } else if (winner.isLandslide) {
                    victoryClass = 'landslide';
                    victoryText = `üöÄ Landslide! +${winner.victoryMargin} votes`;
                    marginClass = 'landslide';
                } else if (winner.isCloseRace) {
                    victoryClass = 'close-race';
                    victoryText = `‚ö° Close Race! +${winner.victoryMargin} votes`;
                    marginClass = 'close';
                } else {
                    victoryClass = 'comfortable';
                    victoryText = `‚ú® Victory! +${winner.victoryMargin} votes`;
                    marginClass = 'comfortable';
                }

                winnersHtml += `
                    <div class="winner-card ${victoryClass}">
                        <div class="winner-position">${positionTitles[position]}</div>
                        <div class="winner-name">${winner.name}</div>
                        <div class="victory-margin ${marginClass}">${victoryText}</div>
                        <div class="win-percentage">${winner.winPercentage}% of ${winner.totalVotes} total votes</div>
                    </div>
                `;
            });

            winnersHtml += `
                    </div>
                    <div style="margin-top: 40px; font-size: 1.2rem; opacity: 0.95; animation: fadeIn 3s ease;">
                        üåü Congratulations to our new galactic leaders! üåü
                    </div>
                </div>
            `;

            announcementDiv.innerHTML = winnersHtml;
            announcementDiv.style.display = 'block';
            
            // Stop body pulse animation
            document.body.style.animation = '';
            
            // Trigger celebration sound (if you want to add audio)
            // playVictorySound();
        }

        // Initialize on page load
        window.addEventListener('load', async () => {
            await loadWinnerAnnouncement();
        });

        // Auto-refresh announcement every 5 seconds when on results tab
        setInterval(() => {
            if (document.getElementById('results-tab').classList.contains('active')) {
                loadWinnerAnnouncement();
            }
        }, 5000);

        // Clean up intervals when page unloads
        window.addEventListener('beforeunload', function() {
            if (announcementCountdownInterval) clearInterval(announcementCountdownInterval);
        });

        // Disable particle background when not needed to save performance
        window.addEventListener('blur', function() {
            document.getElementById('particles-background').classList.remove('active');
        });

        window.addEventListener('focus', function() {
            if (document.querySelector('.winner-announcement')) {
                document.getElementById('particles-background').classList.add('active');
            }
        });
    </script>
</body>
</html>
